digraph G {
    // 全局设置
    rankdir=TB;
    node [shape=box, style=filled, fillcolor=lightblue];
    edge [arrowhead=vee];

    // 根节点
    MiniMindForCausalLM [shape=ellipse, fillcolor=lightgreen];
    model [label="MiniMindModel"];
    MiniMindForCausalLM -> model;
    model_embed_tokens [label="Embedding\n6400x512"];
    model -> model_embed_tokens;
    model_dropout [label="Dropout"];
    model -> model_dropout;
    model_layers [label="ModuleList"];
    model -> model_layers;
    model_layers_0 [label="MiniMindBlock"];
    model_layers -> model_layers_0;
    model_layers_0_self_attn [label="Attention"];
    model_layers_0 -> model_layers_0_self_attn;
    model_layers_0_self_attn_q_proj [label="Linear\n512x512"];
    model_layers_0_self_attn -> model_layers_0_self_attn_q_proj;
    model_layers_0_self_attn_k_proj [label="Linear\n128x512"];
    model_layers_0_self_attn -> model_layers_0_self_attn_k_proj;
    model_layers_0_self_attn_v_proj [label="Linear\n128x512"];
    model_layers_0_self_attn -> model_layers_0_self_attn_v_proj;
    model_layers_0_self_attn_o_proj [label="Linear\n512x512"];
    model_layers_0_self_attn -> model_layers_0_self_attn_o_proj;
    model_layers_0_self_attn_attn_dropout [label="Dropout"];
    model_layers_0_self_attn -> model_layers_0_self_attn_attn_dropout;
    model_layers_0_self_attn_resid_dropout [label="Dropout"];
    model_layers_0_self_attn -> model_layers_0_self_attn_resid_dropout;
    model_layers_0_input_layernorm [label="RMSNorm\n512"];
    model_layers_0 -> model_layers_0_input_layernorm;
    model_layers_0_post_attention_layernorm [label="RMSNorm\n512"];
    model_layers_0 -> model_layers_0_post_attention_layernorm;
    model_layers_0_mlp [label="MOEFeedForward"];
    model_layers_0 -> model_layers_0_mlp;
    model_layers_0_mlp_experts [label="ModuleList"];
    model_layers_0_mlp -> model_layers_0_mlp_experts;
    model_layers_0_mlp_experts_0 [label="FeedForward"];
    model_layers_0_mlp_experts -> model_layers_0_mlp_experts_0;
    model_layers_0_mlp_experts_0_gate_proj [label="Linear\n1408x512"];
    model_layers_0_mlp_experts_0 -> model_layers_0_mlp_experts_0_gate_proj;
    model_layers_0_mlp_experts_0_down_proj [label="Linear\n512x1408"];
    model_layers_0_mlp_experts_0 -> model_layers_0_mlp_experts_0_down_proj;
    model_layers_0_mlp_experts_0_up_proj [label="Linear\n1408x512"];
    model_layers_0_mlp_experts_0 -> model_layers_0_mlp_experts_0_up_proj;
    model_layers_0_mlp_experts_0_dropout [label="Dropout"];
    model_layers_0_mlp_experts_0 -> model_layers_0_mlp_experts_0_dropout;
    model_layers_0_mlp_experts_0_act_fn [label="SiLU"];
    model_layers_0_mlp_experts_0 -> model_layers_0_mlp_experts_0_act_fn;
    model_layers_0_mlp_gate [label="MoEGate\n1x512"];
    model_layers_0_mlp -> model_layers_0_mlp_gate;
    model_layers_0_mlp_shared_experts [label="ModuleList"];
    model_layers_0_mlp -> model_layers_0_mlp_shared_experts;
    model_layers_0_mlp_shared_experts_0 [label="FeedForward"];
    model_layers_0_mlp_shared_experts -> model_layers_0_mlp_shared_experts_0;
    model_layers_0_mlp_shared_experts_0_gate_proj [label="Linear\n1408x512"];
    model_layers_0_mlp_shared_experts_0 -> model_layers_0_mlp_shared_experts_0_gate_proj;
    model_layers_0_mlp_shared_experts_0_down_proj [label="Linear\n512x1408"];
    model_layers_0_mlp_shared_experts_0 -> model_layers_0_mlp_shared_experts_0_down_proj;
    model_layers_0_mlp_shared_experts_0_up_proj [label="Linear\n1408x512"];
    model_layers_0_mlp_shared_experts_0 -> model_layers_0_mlp_shared_experts_0_up_proj;
    model_layers_0_mlp_shared_experts_0_dropout [label="Dropout"];
    model_layers_0_mlp_shared_experts_0 -> model_layers_0_mlp_shared_experts_0_dropout;
    model_layers_0_mlp_shared_experts_0_act_fn [label="SiLU"];
    model_layers_0_mlp_shared_experts_0 -> model_layers_0_mlp_shared_experts_0_act_fn;
    model_norm [label="RMSNorm\n512"];
    model -> model_norm;
    lm_head [label="Linear\n6400x512"];
    MiniMindForCausalLM -> lm_head;
}